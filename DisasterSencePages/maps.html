<html lang="en"><head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DisasterSense — Escape Routes</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&amp;family=Plus+Jakarta+Sans:wght@400;500;600&amp;display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css">
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  
  <!-- Custom styles for responsive design -->
  <style>
    /* Mobile responsive adjustments */
    @media (max-width: 768px) {
      /* Adjust control card positioning for mobile */
      #controls {
        top: 4.5rem !important;
        left: 0.75rem !important;
        right: 0.75rem !important;
        width: auto !important;
      }
      
      /* Make control card full width on mobile */
      #controls > div {
        width: 100% !important;
        max-width: none !important;
      }
      
      /* Adjust title badge for mobile */
      .fixed.top-4.left-4 {
        top: 1rem;
        left: 0.75rem;
        right: 0.75rem;
        max-width: none;
      }
      
      /* Hide subtitle on very small screens */
      @media (max-width: 480px) {
        .fixed.top-4.left-4 .text-sm span:last-child {
          display: none;
        }
      }
      
      /* Adjust bottom meta for mobile */
      .fixed.bottom-4.left-4.right-4 {
        bottom: 1rem;
        left: 0.75rem;
        right: 0.75rem;
      }
      
      /* Make bottom meta text smaller on mobile */
      .fixed.bottom-4.left-4.right-4 p {
        font-size: 0.625rem;
        line-height: 1.2;
      }
      
      /* Ensure map takes full height on mobile */
      #map {
        height: 100vh !important;
      }
      
      /* Adjust button text on mobile */
      @media (max-width: 640px) {
        #find-btn {
          font-size: 0.875rem;
          padding: 0.625rem 1rem;
        }
      }
    }
    
    /* Tablet adjustments */
    @media (min-width: 769px) and (max-width: 1024px) {
      .fixed.top-20.left-4 > div {
        width: min(90vw, 320px);
      }
    }
    
    /* Ensure fixed elements don't interfere with map controls */
    .leaflet-control-container {
      z-index: 1000;
    }
    
    /* Improve touch interactions on mobile */
    @media (max-width: 768px) {
      .pointer-events-auto button,
      .pointer-events-auto select {
        min-height: 44px; /* iOS recommended touch target size */
      }
    }

    /* Custom marker styles to match website theme */
    .user-location-marker {
      background-color: #2dd4bf !important; /* Teal color to match website */
      border-radius: 50%;
      width: 20px !important;
      height: 20px !important;
      margin-left: -10px !important;
      margin-top: -10px !important;
      border: 3px solid white !important;
      box-shadow: 0 0 8px rgba(0,0,0,0.7) !important;
    }
    
    .safe-spot-marker {
      background-color: #f43f5e !important; /* Red for safe spots */
      border-radius: 50%;
      width: 20px !important;
      height: 20px !important;
      margin-left: -10px !important;
      margin-top: -10px !important;
      border: 3px solid white !important;
      box-shadow: 0 0 8px rgba(0,0,0,0.7) !important;
    }

    /* Hide default routing machine instructions */
    .leaflet-routing-container {
      display: none !important;
    }

    /* Custom popup styling */
    .leaflet-popup-content-wrapper {
      border-radius: 8px;
      background: #1f2937;
      color: #f9fafb;
    }

    .leaflet-popup-tip {
      background: #1f2937;
    }

    /* Ensure controls are always visible */
    #controls {
      position: fixed !important;
      top: 5rem !important;
      left: 1rem !important;
      z-index: 1000 !important;
      pointer-events: auto !important;
    }

    #controls > div {
      background: rgba(17, 24, 39, 0.95) !important;
      backdrop-filter: blur(8px) !important;
      border: 1px solid rgba(255, 255, 255, 0.1) !important;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25) !important;
    }

    /* Ensure dropdown text is visible */
    #disaster {
      color: white !important;
      background-color: #374151 !important;
      border-color: #6b7280 !important;
    }

    #disaster option {
      background-color: #374151 !important;
      color: white !important;
    }

    #disaster:focus {
      border-color: #2dd4bf !important;
      box-shadow: 0 0 0 2px rgba(45, 212, 191, 0.2) !important;
    }

    /* Make markers more visible */
    .leaflet-marker-icon {
      z-index: 1000 !important;
    }
  </style>
</head>
<body class="antialiased bg-black text-gray-100 selection:bg-teal-400/20 selection:text-teal-200" style="font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, 'Apple Color Emoji', 'Segoe UI Emoji';">
  <!-- Header -->
  <header class="fixed top-0 inset-x-0 z-50 backdrop-blur-md border-b bg-black/70 border-gray-900">
    <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16">
      <div class="h-full flex items-center justify-between">
        <!-- Brand -->
        <a href="/#home" class="flex items-center gap-2 focus:outline-none focus:ring-2 focus:ring-teal-500 rounded-md">
          <div class="h-6 w-6 rounded-md bg-gradient-to-br from-teal-500 to-cyan-400"></div>
          <span class="text-lg font-medium tracking-tight" style="font-family: 'Plus Jakarta Sans', Inter, sans-serif;">DisasterSense</span>
        </a>

        <!-- Desktop Nav -->
        <div class="hidden md:flex items-center gap-8">
          <a href="/#home" class="group text-sm font-medium text-gray-300 hover:text-gray-100 transition-colors bg-gradient-to-r from-teal-400 to-teal-400 bg-left-bottom bg-no-repeat bg-[length:0%_2px] group-hover:bg-[length:100%_2px] transition-[background-size] duration-300">
            <span>Home</span>
          </a>
          <a href="/prepare.html" class="group text-sm font-medium text-gray-300 hover:text-gray-100 transition-colors bg-gradient-to-r from-teal-400 to-teal-400 bg-left-bottom bg-no-repeat bg-[length:0%_2px] group-hover:bg-[length:100%_2px] transition-[background-size] duration-300">
            <span>Prepare</span>
          </a>
          <a href="/alerts.html" class="group text-sm font-medium text-gray-300 hover:text-gray-100 transition-colors bg-gradient-to-r from-teal-400 to-teal-400 bg-left-bottom bg-no-repeat bg-[length:0%_2px] group-hover:bg-[length:100%_2px] transition-[background-size] duration-300">
            <span class="">Alerts</span>
          </a>
          <a href="/maps.html" aria-current="page" class="group text-sm font-medium text-gray-100 transition-colors bg-gradient-to-r from-teal-400 to-teal-400 bg-left-bottom bg-no-repeat bg-[length:100%_2px]">
            <span class="">Evacuate</span>
          </a>
          <a href="/#contact" class="group text-sm font-medium text-gray-300 hover:text-gray-100 transition-colors bg-gradient-to-r from-teal-400 to-teal-400 bg-left-bottom bg-no-repeat bg-[length:0%_2px] group-hover:bg-[length:100%_2px] transition-[background-size] duration-300">
            <span>Contact</span>
          </a>
        </div>

        <!-- Actions -->
        <div class="flex items-center gap-3">
          <a href="/#contact" class="hidden sm:inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium bg-gray-100 text-black hover:bg-gray-200 transition-all hover:scale-[1.02] focus:outline-none focus:ring-2 focus:ring-teal-500">
            <span class="">Report Incident</span>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-lucide="arrow-right" class="lucide lucide-arrow-right w-4 h-4"><path d="M5 12h14"></path><path d="m12 5 7 7-7 7"></path></svg>
          </a>
          <button id="nav-toggle" aria-expanded="false" aria-controls="mobile-panel" class="md:hidden p-2 rounded-md transition-colors hover:bg-gray-900 focus:outline-none focus:ring-2 focus:ring-teal-500">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-lucide="menu" class="lucide lucide-menu w-5 h-5"><path d="M4 12h16"></path><path d="M4 18h16"></path><path d="M4 6h16"></path></svg>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-lucide="x" class="lucide lucide-x w-5 h-5 hidden"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>
          </button>
        </div>
      </div>
    </nav>

    <!-- Mobile Panel -->
    <div id="mobile-panel" class="fixed inset-0 z-40 pointer-events-none opacity-0 transition-opacity duration-300">
      <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" data-close-overlay=""></div>
      <div id="mobile-drawer" class="absolute top-16 right-2 w-72 bg-gray-950/95 border border-gray-900 rounded-xl shadow-2xl px-4 pt-3 pb-4 translate-x-4 opacity-0 transition-all duration-300">
        <div class="grid gap-2">
          <a href="/#home" data-mobile-link="" class="flex items-center justify-between px-3 py-3 rounded-lg hover:bg-gray-900 border border-transparent hover:border-gray-800 transition-colors">
            <span class="text-base font-medium text-gray-100">Home</span>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-lucide="arrow-up-right" class="lucide lucide-arrow-up-right w-4 h-4 text-gray-400"><path d="M7 7h10v10"></path><path d="M7 17 17 7"></path></svg>
          </a>
          <a href="/prepare.html" data-mobile-link="" class="flex items-center justify-between px-3 py-3 rounded-lg hover:bg-gray-900 border border-transparent hover:border-gray-800 transition-colors">
            <span class="text-base font-medium text-gray-100">Prepare</span>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-lucide="arrow-up-right" class="lucide lucide-arrow-up-right w-4 h-4 text-gray-400"><path d="M7 7h10v10"></path><path d="M7 17 17 7"></path></svg>
          </a>
          <a href="/alerts.html" data-mobile-link="" class="flex items-center justify-between px-3 py-3 rounded-lg hover:bg-gray-900 border border-transparent hover:border-gray-800 transition-colors">
            <span class="text-base font-medium text-gray-100">Alerts</span>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-lucide="arrow-up-right" class="lucide lucide-arrow-up-right w-4 h-4 text-gray-400"><path d="M7 7h10v10"></path><path d="M7 17 17 7"></path></svg>
          </a>
          <a href="/maps.html" data-mobile-link="" class="flex items-center justify-between px-3 py-3 rounded-lg border border-transparent bg-gray-900 hover:border-gray-800 transition-colors">
            <span class="text-base font-medium text-gray-100">Evacuate</span>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-lucide="map" class="lucide lucide-map w-4 h-4 text-gray-400"><path d="M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z"></path><path d="M15 5.764v15"></path><path d="M9 3.236v15"></path></svg>
          </a>
          <a href="/#contact" data-mobile-link="" class="flex items-center justify-between px-3 py-3 rounded-lg hover:bg-gray-900 border border-transparent hover:border-gray-800 transition-colors">
            <span class="text-base font-medium text-gray-100">Contact</span>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-lucide="arrow-up-right" class="lucide lucide-arrow-up-right w-4 h-4 text-gray-400"><path d="M7 7h10v10"></path><path d="M7 17 17 7"></path></svg>
          </a>
        </div>
        <div class="mt-4 flex items-center gap-3">
          <a href="/#services" class="inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium bg-teal-400 text-black hover:bg-teal-300 transition-all hover:scale-[1.02]">
            <span>Get Started</span>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-lucide="sparkles" class="lucide lucide-sparkles w-4 h-4"><path d="M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z"></path><path d="M20 2v4"></path><path d="M22 4h-4"></path><circle cx="4" cy="20" r="2"></circle></svg>
          </a>
          <a href="mailto:support@disastersense.org" class="inline-flex items-center gap-2 text-sm text-gray-400 hover:text-gray-200">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-lucide="mail" class="lucide lucide-mail w-4 h-4"><path d="m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7"></path><rect x="2" y="4" width="20" height="16" rx="2"></rect></svg>
            support@disastersense.org
          </a>
        </div>
      </div>
    </div>
  </header>

  <!-- Map Wrapper -->
  <main class="pt-16">
    <section class="relative">
      <div id="map" class="w-full h-[calc(100vh-4rem)] leaflet-container leaflet-touch leaflet-fade-anim leaflet-grab leaflet-touch-drag leaflet-touch-zoom" tabindex="0" style="position: relative; outline-style: none;"><div class="leaflet-pane leaflet-map-pane" style="transform: translate3d(0px, 0px, 0px);"><div class="leaflet-pane leaflet-tile-pane"><div class="leaflet-layer" style="z-index: 1; opacity: 1;"><div class="leaflet-tile-container leaflet-zoom-animated" style="z-index: 19; transform: translate3d(0px, 0px, 0px) scale(1);"><img alt="" src="https://a.tile.openstreetmap.org/15/23024/14602.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(151px, 95px, 0px); opacity: 1;"><img alt="" src="https://b.tile.openstreetmap.org/15/23025/14602.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(407px, 95px, 0px); opacity: 1;"><img alt="" src="https://c.tile.openstreetmap.org/15/23024/14601.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(151px, -161px, 0px); opacity: 1;"><img alt="" src="https://a.tile.openstreetmap.org/15/23025/14601.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(407px, -161px, 0px); opacity: 1;"><img alt="" src="https://b.tile.openstreetmap.org/15/23024/14603.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(151px, 351px, 0px); opacity: 1;"><img alt="" src="https://c.tile.openstreetmap.org/15/23025/14603.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(407px, 351px, 0px); opacity: 1;"><img alt="" src="https://c.tile.openstreetmap.org/15/23023/14602.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(-105px, 95px, 0px); opacity: 1;"><img alt="" src="https://c.tile.openstreetmap.org/15/23026/14602.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(663px, 95px, 0px); opacity: 1;"><img alt="" src="https://b.tile.openstreetmap.org/15/23023/14601.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(-105px, -161px, 0px); opacity: 1;"><img alt="" src="https://b.tile.openstreetmap.org/15/23026/14601.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(663px, -161px, 0px); opacity: 1;"><img alt="" src="https://a.tile.openstreetmap.org/15/23023/14603.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(-105px, 351px, 0px); opacity: 1;"><img alt="" src="https://a.tile.openstreetmap.org/15/23026/14603.png" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(663px, 351px, 0px); opacity: 1;"></div></div></div><div class="leaflet-pane leaflet-overlay-pane"></div><div class="leaflet-pane leaflet-shadow-pane"></div><div class="leaflet-pane leaflet-marker-pane"><div class="leaflet-marker-icon leaflet-zoom-animated leaflet-interactive" tabindex="0" role="button" style="margin-left: -9px; margin-top: -9px; width: 18px; height: 18px; transform: translate3d(455px, 263px, 0px); z-index: 263;"><div style="width:18px;height:18px;border-radius:9999px;background:#60a5fa;border:2px solid #fff;box-shadow:0 0 6px rgba(0,0,0,.5)"></div></div></div><div class="leaflet-pane leaflet-tooltip-pane"></div><div class="leaflet-pane leaflet-popup-pane"></div><div class="leaflet-proxy leaflet-zoom-animated" style="transform: translate3d(5.89445e+06px, 3.73828e+06px, 0px) scale(16384);"></div></div><div class="leaflet-control-container"><div class="leaflet-top leaflet-left"><div class="leaflet-control-zoom leaflet-bar leaflet-control"><a class="leaflet-control-zoom-in" href="#" title="Zoom in" role="button" aria-label="Zoom in" aria-disabled="false"><span aria-hidden="true" class="">+</span></a><a class="leaflet-control-zoom-out" href="#" title="Zoom out" role="button" aria-label="Zoom out" aria-disabled="false"><span aria-hidden="true">−</span></a></div></div><div class="leaflet-top leaflet-right"></div><div class="leaflet-bottom leaflet-left"></div><div class="leaflet-bottom leaflet-right"><div class="leaflet-control-attribution leaflet-control"><a href="https://leafletjs.com" title="A JavaScript library for interactive maps"><svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"></path><path fill="#FFD500" d="M0 4h12v3H0z"></path><path fill="#E0BC00" d="M0 7h12v1H0z"></path></svg> Leaflet</a> <span aria-hidden="true">|</span> © OpenStreetMap contributors</div></div></div></div>

      <!-- Overlay Controls -->
      <div class="pointer-events-none absolute inset-0">

        <!-- Control Card -->
        <div id="controls" class="pointer-events-auto fixed top-20 left-4 z-50">
          <div class="w-[min(92vw,360px)] sm:w-[min(90vw,360px)] md:w-80 lg:w-96 rounded-xl border border-white/10 bg-gray-950/95 backdrop-blur px-4 py-4 shadow-2xl">
            <div class="flex items-center justify-between mb-3">
              <label for="disaster" class="text-sm font-medium text-gray-300">Select Disaster:</label>
              <div class="flex items-center gap-1.5 text-xs text-gray-500">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-lucide="radar" class="lucide lucide-radar w-3.5 h-3.5"><path d="M19.07 4.93A10 10 0 0 0 6.99 3.34"></path><path d="M4 6h.01"></path><path d="M2.29 9.62A10 10 0 1 0 21.31 8.35"></path><path d="M16.24 7.76A6 6 0 1 0 8.23 16.67"></path><path d="M12 18h.01"></path><path d="M17.99 11.66A6 6 0 0 1 15.77 16.67"></path><circle cx="12" cy="12" r="2"></circle><path d="m13.41 10.59 5.66-5.66"></path></svg>
                Live tracking
              </div>
            </div>
            <div class="mb-3">
              <select id="disaster" class="w-full rounded-lg bg-gray-800 border border-gray-600 px-3 py-2.5 text-sm text-white outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition">
                <option value="earthquake" class="bg-gray-800 text-white">Earthquake (Open Spaces)</option>
                <option value="flood" class="bg-gray-800 text-white">Flood (High Ground)</option>
                <option value="cyclone" class="bg-gray-800 text-white">Cyclone (Shelters)</option>
                <option value="landslide" class="bg-gray-800 text-white">Landslide (Stable Ground)</option>
              </select>
            </div>
            <div class="mb-3">
              <button id="find-btn" class="w-full inline-flex items-center justify-center gap-2 px-3.5 py-2.5 rounded-lg bg-teal-400 text-black text-sm font-medium hover:bg-teal-300 transition-all hover:scale-[1.02] focus:outline-none focus:ring-2 focus:ring-teal-500">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-lucide="route" class="lucide lucide-route w-4 h-4"><circle cx="6" cy="19" r="3"></circle><path d="M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15"></path><circle cx="18" cy="5" r="3"></circle></svg>
                Find Safe Spot &amp; Route
              </button>
            </div>
            <div id="status-message" class="text-xs text-gray-400 mb-3">Getting your current location...</div>
            <div class="flex items-center gap-2 text-[11px] text-gray-500">
              <span class="inline-flex items-center gap-1 px-2 py-1 rounded-md bg-white/5 border border-white/10">
                <span class="inline-block w-2 h-2 rounded-full" style="background:#2dd4bf;"></span>
                You
              </span>
              <span class="inline-flex items-center gap-1 px-2 py-1 rounded-md bg-white/5 border border-white/10">
                <span class="inline-block w-2 h-2 rounded-full" style="background:#f43f5e;"></span>
                Safe spot
              </span>
            </div>
          </div>
        </div>

        <!-- Bottom Meta -->
        <div class="pointer-events-none fixed bottom-4 left-4 right-4 z-50">
          <div class="pointer-events-auto inline-flex items-center gap-2 rounded-lg bg-white/5 border border-white/10 px-3 py-2 backdrop-blur shadow-lg">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-lucide="info" class="lucide lucide-info w-3.5 h-3.5 text-gray-300"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg>
            <p class="text-[11px] text-gray-400">Data: OpenStreetMap, OSRM. Routes may be impacted by closures. Stay safe and follow local advisories.</p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="border-t border-white/10 bg-gray-950">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
      <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
        <a href="/#home" class="inline-flex items-center gap-2">
          <div class="h-6 w-6 rounded-md bg-gradient-to-br from-teal-500 to-cyan-400"></div>
          <span class="text-lg font-medium" style="font-family: 'Plus Jakarta Sans', Inter, sans-serif;">DisasterSense</span>
        </a>
        <p class="text-xs text-gray-500">© <span id="year">2025</span> DisasterSense. All rights reserved.</p>
        <div class="flex items-center gap-5 text-xs text-gray-500">
          <a href="#" class="hover:text-gray-300">Privacy</a>
          <a href="#" class="hover:text-gray-300">Terms</a>
          <a href="#" class="hover:text-gray-300">Security</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- Scripts -->
  <script>
    // Icons
    window.lucide && window.lucide.createIcons();

    // Footer year
    document.getElementById('year').textContent = new Date().getFullYear();

    // Mobile drawer
    const navToggle = document.getElementById('nav-toggle');
    const mobilePanel = document.getElementById('mobile-panel');
    const mobileDrawer = document.getElementById('mobile-drawer');
    const closeDrawer = () => {
      mobilePanel.classList.add('opacity-0', 'pointer-events-none');
      mobileDrawer.classList.add('translate-x-4', 'opacity-0');
      navToggle.setAttribute('aria-expanded', 'false');
      navToggle.querySelector('[data-lucide="menu"]').classList.remove('hidden');
      navToggle.querySelector('[data-lucide="x"]').classList.add('hidden');
    };
    const openDrawer = () => {
      mobilePanel.classList.remove('opacity-0', 'pointer-events-none');
      mobileDrawer.classList.remove('translate-x-4', 'opacity-0');
      navToggle.setAttribute('aria-expanded', 'true');
      navToggle.querySelector('[data-lucide="menu"]').classList.add('hidden');
      navToggle.querySelector('[data-lucide="x"]').classList.remove('hidden');
    };
    navToggle.addEventListener('click', () => {
      const expanded = navToggle.getAttribute('aria-expanded') === 'true';
      expanded ? closeDrawer() : openDrawer();
    });
    mobilePanel.addEventListener('click', (e) => {
      if (e.target.hasAttribute('data-close-overlay')) closeDrawer();
    });
    document.querySelectorAll('[data-mobile-link]').forEach(a => a.addEventListener('click', closeDrawer));

    // Map + Routing
    const map = L.map('map', { zoomControl: true }).setView([20.5937, 78.9629], 5);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    // Custom icons for markers
    const userIcon = L.divIcon({
      html: '<div class="user-location-marker"></div>',
      className: '',
      iconSize: [20, 20],
      iconAnchor: [10, 10]
    });

    const safeSpotIcon = L.divIcon({
      html: '<div class="safe-spot-marker"></div>',
      className: '',
      iconSize: [20, 20],
      iconAnchor: [10, 10]
    });

    let userMarker, safeMarker, routingControl;
    let userLat, userLng;
    let safeLat, safeLon;
    const statusEl = document.getElementById('status-message');
    const findBtn = document.getElementById('find-btn');

    // --- Geolocation with continuous tracking ---
    function setupGeolocationWatcher() {
      if (navigator.geolocation) {
        statusEl.textContent = 'Getting your current location and tracking...';
      navigator.geolocation.watchPosition(
        pos => {
          const newLat = pos.coords.latitude;
          const newLng = pos.coords.longitude;

            // Only update if location has changed significantly to avoid jitter
            if (userLat === undefined || userLng === undefined || 
                L.latLng(userLat, userLng).distanceTo(L.latLng(newLat, newLng)) > 5) { // 5 meters threshold
              
              userLat = newLat;
              userLng = newLng;

            if (userMarker) {
              userMarker.setLatLng([userLat, userLng]);
            } else {
              userMarker = L.marker([userLat, userLng], { icon: userIcon }).addTo(map)
                  .bindPopup('Your Location').openPopup();
              }
              
              map.setView([userLat, userLng], 15); // Keep map centered on user
              statusEl.textContent = `Location updated: ${userLat.toFixed(4)}, ${userLng.toFixed(4)}`;

              // If a safe spot is already selected, re-route
            if (safeLat && safeLon) {
              drawRoute(userLat, userLng, safeLat, safeLon);
            }
          }
        },
          (error) => {
            console.error('Geolocation error:', error);
            alert('Location access denied or unavailable. Please enable location services.');
            statusEl.textContent = 'Location access denied. Using default center.';
          },
          {
            enableHighAccuracy: true,
            maximumAge: 10000, // Accept cached position up to 10 seconds old
            timeout: 5000     // Wait 5 seconds for a position
          }
        );
      } else {
        alert('Geolocation not supported by this browser.');
        statusEl.textContent = 'Geolocation not supported.';
      }
    }

    // Call on load to start tracking user location
    setupGeolocationWatcher();

    // --- Elevation Helper ---
    async function getElevation(latitude, longitude) {
      try {
        const elevUrl = `https://api.open-elevation.com/api/v1/lookup?locations=${latitude},${longitude}`;
        const response = await fetch(elevUrl);
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const data = await response.json();
        if (data.results && data.results.length > 0) {
          return data.results[0].elevation;
        }
        return null;
      } catch (error) {
        console.error('Error fetching elevation:', error);
        return null;
      }
    }

    // --- Route Drawing Function ---
    function drawRoute(startLat, startLng, endLat, endLon) {
      statusEl.textContent = 'Calculating escape route...';
      if (routingControl) {
        map.removeControl(routingControl);
      }

      routingControl = L.Routing.control({
        waypoints: [
          L.latLng(startLat, startLng),
          L.latLng(endLat, endLon)
        ],
        router: L.Routing.osrmv1({
          serviceUrl: 'https://router.project-osrm.org/route/v1'
        }),
        lineOptions: {
          styles: [{ color: '#2dd4bf', weight: 6, opacity: 0.7, dashArray: '10, 10' }] // Teal dotted line
        },
        createMarker: function(i, waypoint, n) {
          // Customize markers for start and end
          if (i === 0) { // Start marker (user's location)
            return L.marker(waypoint.latLng, { icon: userIcon });
          } else if (i === n - 1) { // End marker (safe spot)
            return L.marker(waypoint.latLng, { icon: safeSpotIcon });
          }
          return null; // Don't create default intermediate markers
        },
        routeWhileDragging: false,
        showAlternatives: false,
        fitSelectedRoutes: true,
        altLineOptions: {
          styles: [{color: 'black', opacity: 0.15, weight: 9, dashArray: '10, 10'}, {color: 'white', opacity: 0.8, weight: 6, dashArray: '10, 10'}]
        }
      }).addTo(map);

      routingControl.on('routesfound', function(e) {
        const routes = e.routes;
        const summary = routes[0].summary;
        statusEl.textContent = `Route found: ${summary.totalDistance / 1000} km, ${Math.round(summary.totalTime / 60)} minutes.`;
      });

      routingControl.on('routingerror', function(e) {
        statusEl.textContent = 'Could not find a route to the safe spot.';
        console.error('Routing error:', e.error.message);
        alert('Failed to calculate escape route. The safe spot might be inaccessible by road.');
      });
    }

    // --- Safe Spot Finding Logic ---
    async function findSafeSpots(searchRadiusKm = 2, maxRadiusKm = 20) {
      if (!userLat || !userLng) {
        statusEl.textContent = 'Please wait, getting your location to find safe spots...';
        alert('Your location is not yet available. Please ensure location services are enabled and try again.');
        return;
      }

      statusEl.textContent = `Searching for safe spots (radius: ${searchRadiusKm}km)...`;
      const disaster = document.getElementById('disaster').value;
      const radiusMeters = searchRadiusKm * 1000; // Convert km to meters for Overpass around query

      let overpassQuery = `
        [out:json][timeout:25];
        (
      `;

      switch (disaster) {
        case 'earthquake': // Open spaces
          overpassQuery += `
            node["leisure"="park"](around:${radiusMeters},${userLat},${userLng});
            node["leisure"="pitch"](around:${radiusMeters},${userLat},${userLng});
            node["landuse"="meadow"](around:${radiusMeters},${userLat},${userLng});
            node["landuse"="grass"](around:${radiusMeters},${userLat},${userLng});
          `;
          break;
        case 'flood': // High ground (will filter by elevation)
          overpassQuery += `
            node["natural"="hill"](around:${radiusMeters},${userLat},${userLng});
            node["natural"="peak"](around:${radiusMeters},${userLat},${userLng});
            node["natural"="ridge"](around:${radiusMeters},${userLat},${userLng});
            node["amenity"="shelter"](around:${radiusMeters},${userLat},${userLng});
            node["building"="hospital"](around:${radiusMeters},${userLat},${userLng});
            node["building"="school"](around:${radiusMeters},${userLat},${userLng});
          `;
          break;
        case 'cyclone': // Robust shelters
          overpassQuery += `
            node["amenity"="community_centre"](around:${radiusMeters},${userLat},${userLng});
            node["amenity"="school"](around:${radiusMeters},${userLat},${userLng});
            node["building"="public"](around:${radiusMeters},${userLat},${userLng});
            node["building"="hospital"](around:${radiusMeters},${userLat},${userLng});
          `;
          break;
        case 'landslide': // Flat, stable ground
          overpassQuery += `
            node["landuse"="residential"](around:${radiusMeters},${userLat},${userLng});
            node["landuse"="farmland"](around:${radiusMeters},${userLat},${userLng});
            node["natural"="plateau"](around:${radiusMeters},${userLat},${userLng});
          `;
          break;
      }
      overpassQuery += `
        );
        out center;
      `;

      const overpassUrl = 'https://overpass-api.de/api/interpreter?data=' + encodeURIComponent(overpassQuery);

      try {
        const response = await fetch(overpassUrl);
        if (!response.ok) throw new Error(`Overpass API error! status: ${response.status}`);
        const data = await response.json();

        let potentialSpots = data.elements;
        console.log(`Found ${potentialSpots.length} potential spots at ${searchRadiusKm}km for ${disaster}.`);

        // Filter by elevation/slope if applicable
        if (disaster === 'flood' || disaster === 'landslide') {
          statusEl.textContent = 'Filtering spots by elevation/slope...';
          const userElevation = await getElevation(userLat, userLng);
          if (userElevation === null) {
            statusEl.textContent = 'Could not get user elevation for filtering. Skipping elevation filter.';
          } else {
            const filteredSpots = [];
            for (const spot of potentialSpots) {
              const spotElevation = await getElevation(spot.lat, spot.lon);
              if (spotElevation !== null) {
                if (disaster === 'flood' && spotElevation > userElevation + 5) { // At least 5m higher
                  filteredSpots.push(spot);
                } else if (disaster === 'landslide' && Math.abs(spotElevation - userElevation) < 10) { // Relatively flat
                  filteredSpots.push(spot);
                }
              }
            }
            potentialSpots = filteredSpots;
            console.log(`After elevation/slope filtering, ${potentialSpots.length} spots remain.`);
          }
        }

        if (potentialSpots.length === 0) {
          if (searchRadiusKm < maxRadiusKm) {
            statusEl.textContent = `No suitable spots found. Expanding search to ${searchRadiusKm + 3}km...`;
            return findSafeSpots(searchRadiusKm + 3, maxRadiusKm); // Increase radius and retry
          } else {
            statusEl.textContent = 'No safe spots found within maximum search area.';
            alert('No safe spots found nearby within the maximum search radius. Please try again later or a different location.');
            return;
          }
        }

        // For simplicity, just pick the first one after filtering
        const safeSpot = potentialSpots[0];
        safeLat = safeSpot.lat; // Store globally
        safeLon = safeSpot.lon; // Store globally

        if (safeMarker) map.removeLayer(safeMarker);
        safeMarker = L.marker([safeLat, safeLon], { icon: safeSpotIcon })
          .addTo(map)
                      .bindPopup(`Safe Spot: ${safeSpot.tags.name || safeSpot.tags.amenity || 'Unnamed'}`)
          .openPopup();

        // Draw the initial route
        drawRoute(userLat, userLng, safeLat, safeLon);

      } catch (error) {
        console.error('Error in findSafeSpots:', error);
        statusEl.textContent = `Error: ${error.message}.`;
        alert('An error occurred while searching for safe spots or routes. Please check console for details.');
      }
    }

    document.getElementById('find-btn').addEventListener('click', () => {
      findBtn.disabled = true;
      findBtn.classList.add('opacity-70', 'cursor-wait');
      findSafeSpots().finally(() => {
        findBtn.disabled = false;
        findBtn.classList.remove('opacity-70', 'cursor-wait');
      });
    });
  </script>

</body></html>